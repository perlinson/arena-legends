<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Arena Legends - å³æ—¶åˆ¶å¯¹æˆ˜</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
        }
        .nav {
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-links a {
            color: #fff;
            text-decoration: none;
            opacity: 0.8;
            font-size: 0.9rem;
            margin-left: 15px;
        }
        .game-container { max-width: 1100px; margin: 0 auto; padding: 10px; }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(0,0,0,0.4);
            border-radius: 12px;
            margin-bottom: 10px;
        }
        .player-info { display: flex; align-items: center; gap: 12px; }
        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        .avatar.hero { background: linear-gradient(135deg, #3498db, #2980b9); }
        .avatar.enemy { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .mana-display {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(52, 152, 219, 0.25);
            padding: 8px 14px;
            border-radius: 18px;
            border: 2px solid rgba(52, 152, 219, 0.5);
        }
        .mana-value { font-size: 1rem; font-weight: bold; color: #3498db; }
        .battlefield {
            background: linear-gradient(180deg, #1a1a2e 0%, #2c3e50 15%, #2ecc71 35%, #27ae60 65%, #1e8449 100%);
            border-radius: 15px;
            padding: 12px;
            min-height: 320px;
        }
        .battle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 450px;
            margin: 0 auto;
        }
        .field-slot {
            height: 65px;
            background: rgba(255,255,255,0.06);
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .field-slot.player-minion {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.4), rgba(41, 128, 185, 0.6));
            border: 2px solid rgba(52, 152, 219, 0.8);
        }
        .field-slot.enemy-minion {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.4), rgba(192, 57, 43, 0.6));
            border: 2px solid rgba(231, 76, 60, 0.8);
        }
        .slot-label { font-size: 0.65rem; opacity: 0.4; }
        .minion-content { text-align: center; padding: 3px; }
        .minion-art { font-size: 1.4rem; }
        .minion-name { font-size: 0.55rem; opacity: 0.9; }
        .minion-stats {
            display: flex;
            gap: 8px;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
        }
        .attack-progress-bar {
            position: absolute;
            bottom: 3px;
            left: 5px;
            right: 5px;
            height: 4px;
            background: rgba(0,0,0,0.4);
            border-radius: 2px;
            overflow: hidden;
        }
        .attack-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            width: 0%;
            transition: width 0.1s;
        }
        .hand-area {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 12px;
            margin-top: 10px;
        }
        .hand-label { text-align: center; margin-bottom: 10px; opacity: 0.7; }
        .hand-cards { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .hand-card {
            width: 80px;
            height: 108px;
            background: linear-gradient(180deg, #2c3e50, #34495e);
            border-radius: 8px;
            padding: 5px;
            position: relative;
            cursor: grab;
            border: 2px solid #555;
        }
        .hand-card:hover { transform: translateY(-10px); border-color: #f39c12; }
        .card-cost {
            position: absolute;
            top: -4px;
            left: -4px;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.75rem;
            border: 2px solid #fff;
        }
        .card-art { font-size: 1.8rem; text-align: center; margin: 8px 0; }
        .card-name { font-size: 0.6rem; text-align: center; font-weight: bold; }
        .hand-stats { display: flex; justify-content: space-between; padding: 0 4px; margin-top: 4px; }
        .hand-stats span { font-size: 0.7rem; font-weight: bold; }
        .btn-restart {
            padding: 8px 20px;
            border-radius: 18px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: #fff;
            border: none;
            margin-top: 12px;
        }
        .rules {
            background: rgba(0,0,0,0.2);
            padding: 10px 12px;
            border-radius: 10px;
            margin-top: 12px;
            font-size: 0.75rem;
        }
        .rules-title { font-weight: bold; color: #f39c12; margin-bottom: 6px; }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="logo">Arena Legends</div>
        <div class="nav-links">
            <a href="index.html">é¦–é¡µ</a>
            <a href="game.html">å³æ—¶å¯¹æˆ˜</a>
            <a href="multiplayer.html">å®æ—¶PVP</a>
        </div>
    </nav>
    
    <div class="game-container">
        <div class="top-bar">
            <div class="player-info">
                <div class="avatar hero">ğŸ‘¤</div>
                <div>ç©å®¶ <span id="playerHealth" style="color:#e74c3c;font-weight:bold;">30</span></div>
            </div>
            <div class="mana-display">
                <span>ğŸ’</span>
                <span class="mana-value" id="manaDisplay">4/10</span>
            </div>
            <div class="player-info">
                <div>æ•Œæ–¹ <span id="enemyHealth" style="color:#e74c3c;font-weight:bold;">30</span></div>
                <div class="avatar enemy">ğŸ‘¹</div>
            </div>
        </div>
        
        <div class="battlefield">
            <div class="battle-grid" id="enemyFieldGrid"></div>
            <div style="text-align:center;padding:10px;font-size:0.9rem;opacity:0.8;">âš”ï¸ éšä»æ”»å‡»æ—¶ä¼šæœ‰åŠ¨ç”»</div>
            <div class="battle-grid" id="playerFieldGrid"></div>
        </div>
        
        <div class="hand-area">
            <div class="hand-label">ğŸ´ æ‹–æ‹½å¡ç‰Œåˆ°æˆ˜åœºæ ¼å­</div>
            <div class="hand-cards" id="handContainer"></div>
        </div>
        
        <div style="text-align:center;">
            <button class="btn-restart" onclick="restartGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>
        
        <div class="rules">
            <div class="rules-title">ğŸ“‹ æˆ˜æ–—è§„åˆ™</div>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,150px);gap:6px;">
                <div>ğŸ’ æ¯3.33ç§’+1åœ£æ°´</div>
                <div>ğŸ“Š æ”»å‡»è¿›åº¦æ¡</div>
                <div>ğŸ’¥ è¿›åº¦æ»¡æ”»å‡»åŠ¨ç”»</div>
                <div>ğŸ”µ å·±æ–¹è“è‰²/ğŸ”´ æ•Œæ–¹çº¢è‰²</div>
            </div>
        </div>
    </div>

    <script>
    // æ¸¸æˆé…ç½®
    const CONFIG = {
        manaPerSecond: 0.3,
        maxMana: 10,
        attackInterval: 5000,
        manaStart: 4
    };
    
    // æ¸¸æˆçŠ¶æ€
    let game = {
        player: { mana: CONFIG.manaStart, health: 30, hand: [], field: [null,null,null,null,null,null], deck: [] },
        enemy: { health: 30, field: [null,null,null,null,null,null] },
        isRunning: true
    };
    
    // ç‰Œå †æ¨¡æ¿
    const CARD_TEMPLATES = [
        { name: 'ç‹¼éª‘å…µ', cost: 3, attack: 4, health: 3, art: 'ğŸº', keywords: ['å†²é”‹'] },
        { name: 'ç«å…ƒç´ ', cost: 4, attack: 5, health: 5, art: 'ğŸ”¥', keywords: [] },
        { name: 'å†°éœœéª‘å£«', cost: 5, attack: 6, health: 6, art: 'ğŸ›¡ï¸', keywords: ['å˜²è®½'] },
        { name: 'ç²¾çµå¼“æ‰‹', cost: 2, attack: 3, health: 2, art: 'ğŸ¹', keywords: ['çªè¢­'] },
        { name: 'æ²»ç–—ç²¾çµ', cost: 2, attack: 1, health: 4, art: 'ğŸ’š', keywords: ['æˆ˜å¼'] },
        { name: 'é—ªç”µç®­', cost: 3, attack: 4, health: 2, art: 'âš¡', keywords: [] },
        { name: 'ç«é¾™', cost: 6, attack: 8, health: 7, art: 'ğŸ‰', keywords: ['å†²é”‹'] },
        { name: 'éª·é«…å…µ', cost: 1, attack: 2, health: 1, art: 'ğŸ’€', keywords: [] },
        { name: 'çŸ³å·¨äºº', cost: 4, attack: 4, health: 7, art: 'ğŸ—¿', keywords: ['å˜²è®½'] }
    ];
    
    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
        console.log('âš”ï¸ Arena Legends åˆå§‹åŒ–...');
        createDeck();
        dealCards(4);
        renderAll();
        startGameLoop();
        console.log('âœ… æ¸¸æˆå¯åŠ¨æˆåŠŸ!');
    }
    
    // åˆ›å»ºç‰Œå †
    function createDeck() {
        for (let i = 0; i < 15; i++) {
            const template = CARD_TEMPLATES[i % CARD_TEMPLATES.length];
            game.player.deck.push({
                ...template,
                id: 'card_' + Date.now() + '_' + i,
                attackProgress: 0
            });
        }
    }
    
    // å‘ç‰Œ
    function dealCards(count) {
        for (let i = 0; i < count; i++) {
            if (game.player.deck.length > 0 && game.player.hand.length < 7) {
                game.player.hand.push(game.player.deck.pop());
            }
        }
    }
    
    // å¯åŠ¨æ¸¸æˆå¾ªç¯
    function startGameLoop() {
        // åœ£æ°´æ¢å¤
        setInterval(() => {
            if (!game.isRunning) return;
            if (game.player.mana < CONFIG.maxMana) {
                game.player.mana = Math.min(game.player.mana + 1, CONFIG.maxMana);
                document.getElementById('manaDisplay').textContent = game.player.mana + '/' + CONFIG.maxMana;
            }
        }, 3330);
        
        // æ”»å‡»è¿›åº¦
        setInterval(() => {
            if (!game.isRunning) return;
            updateAttackProgress();
        }, 100);
        
        // æ•Œæ–¹AI
        setInterval(() => {
            if (!game.isRunning) return;
            enemyAI();
        }, 4000);
        
        // å®šæ—¶å‘ç‰Œ
        setInterval(() => {
            if (!game.isRunning) return;
            if (game.player.hand.length < 7) {
                dealCards(1);
                renderHand();
            }
        }, 12000);
    }
    
    // æ›´æ–°æ”»å‡»è¿›åº¦
    function updateAttackProgress() {
        const perTick = 100 / (CONFIG.attackInterval / 100);
        
        for (let i = 0; i < 6; i++) {
            const minion = game.player.field[i];
            if (minion && minion.health > 0) {
                minion.attackProgress = Math.min(minion.attackProgress + perTick, 100);
                if (minion.attackProgress >= 100) {
                    performAttack('player', i);
                    return;
                }
            }
        }
        
        for (let i = 0; i < 6; i++) {
            const minion = game.enemy.field[i];
            if (minion && minion.health > 0) {
                minion.attackProgress = Math.min(minion.attackProgress + perTick, 100);
                if (minion.attackProgress >= 100) {
                    performAttack('enemy', i);
                    return;
                }
            }
        }
        
        updateProgressBars();
    }
    
    // æ‰§è¡Œæ”»å‡»
    function performAttack(side, index) {
        const field = side === 'player' ? game.player.field : game.enemy.field;
        const attacker = field[index];
        if (!attacker || attacker.health <= 0) return;
        
        const targetField = side === 'player' ? game.enemy.field : game.player.field;
        const targetIndex = index;
        const target = targetField[targetIndex];
        
        // æ’­æ”¾åŠ¨ç”»
        playAttackAnimation(side, index, targetIndex, () => {
            if (target && target.health > 0) {
                target.health -= attacker.attack;
                attacker.health -= target.attack;
                showMessage(attacker.name + ' â†”ï¸ ' + target.name + '!');
            } else {
                if (side === 'player') game.enemy.health -= attacker.attack;
                else game.player.health -= attacker.attack;
                showMessage(attacker.name + ' æ”»å‡»è‹±é›„! -' + attacker.attack);
            }
            
            if (attacker.health <= 0) field[index] = null;
            if (target && target.health <= 0) targetField[targetIndex] = null;
            
            attacker.attackProgress = 0;
            if (target) target.attackProgress = 0;
            
            renderAll();
            updateHealthDisplay();
            checkGameEnd();
        });
    }
    
    // æ”»å‡»åŠ¨ç”»
    function playAttackAnimation(side, fromIdx, toIdx, callback) {
        const fromEl = document.querySelector('#' + (side === 'player' ? 'playerFieldGrid' : 'enemyFieldGrid') + ' .field-slot[data-index="' + fromIdx + '"]');
        if (!fromEl) { callback(); return; }
        
        const clone = fromEl.cloneNode(true);
        const rect = fromEl.getBoundingClientRect();
        clone.style.cssText = 'position:fixed;left:' + rect.left + 'px;top:' + rect.top + 'px;z-index:1000;pointer-events:none;transition:all 0.2s ease-in-out;';
        document.body.appendChild(clone);
        
        const moveX = side === 'player' ? 50 : -50;
        const moveY = side === 'player' ? 30 : -30;
        
        setTimeout(() => { clone.style.transform = 'translate(' + moveX + 'px,' + moveY + 'px) scale(1.2)'; }, 50);
        setTimeout(() => { clone.style.transform = 'translate(0,0) scale(1)'; }, 300);
        setTimeout(() => { clone.remove(); callback(); }, 500);
    }
    
    // æ•Œæ–¹AI
    function enemyAI() {
        const emptySlots = game.enemy.field.map((s, i) => s === null ? i : -1).filter(i => i !== -1);
        
        if (emptySlots.length > 0 && Math.random() > 0.4) {
            const slot = emptySlots[Math.floor(Math.random() * emptySlots.length)];
            const enemies = [
                { name: 'æ•Œæ–¹ç‹¼äºº', attack: 4, health: 3, art: 'ğŸº' },
                { name: 'æ•Œæ–¹ç«å…ƒç´ ', attack: 5, health: 5, art: 'ğŸ”¥' },
                { name: 'æ•Œæ–¹éª·é«…', attack: 2, health: 1, art: 'ğŸ’€' }
            ];
            const card = { ...enemies[Math.floor(Math.random() * enemies.length)], id: 'enemy_' + Date.now(), attackProgress: 0 };
            game.enemy.field[slot] = card;
            renderEnemyField();
            showMessage('ğŸ˜ˆ æ•Œæ–¹æ”¾ç½®äº† ' + card.name + '!');
        }
    }
    
    // æ¸²æŸ“æ‰€æœ‰
    function renderAll() {
        renderHand();
        renderPlayerField();
        renderEnemyField();
        updateHealthDisplay();
    }
    
    // æ¸²æŸ“æ‰‹ç‰Œ
    function renderHand() {
        const container = document.getElementById('handContainer');
        if (!container) return;
        
        if (game.player.hand.length === 0) {
            container.innerHTML = '<div style="padding:20px;opacity:0.6;">ç­‰å¾…å‘ç‰Œ...</div>';
            return;
        }
        
        container.innerHTML = game.player.hand.map((card, idx) => 
            '<div class="hand-card" draggable="true" data-index="' + idx + '" data-id="' + card.id + '">' +
            '<div class="card-cost">' + card.cost + '</div>' +
            '<div class="card-art">' + card.art + '</div>' +
            '<div class="card-name">' + card.name + '</div>' +
            '<div class="hand-stats"><span style="color:#e74c3c;">âš”ï¸' + card.attack + '</span><span style="color:#2ecc71;">â¤ï¸' + card.health + '</span></div>' +
            '</div>'
        ).join('');
        
        // æ‹–æ‹½äº‹ä»¶
        container.querySelectorAll('.hand-card').forEach(el => {
            el.addEventListener('dragstart', e => {
                e.dataTransfer.setData('text/plain', el.dataset.index);
                el.style.opacity = '0.5';
            });
            el.addEventListener('dragend', () => el.style.opacity = '1');
        });
    }
    
    // æ¸²æŸ“ç©å®¶æˆ˜åœº
    function renderPlayerField() {
        const grid = document.getElementById('playerFieldGrid');
        if (!grid) return;
        
        grid.innerHTML = '';
        for (let i = 0; i < 6; i++) {
            const minion = game.player.field[i];
            const slot = document.createElement('div');
            slot.className = 'field-slot';
            slot.dataset.index = i;
            
            if (minion) {
                slot.classList.add('player-minion');
                slot.innerHTML = createMinionHTML(minion, 'player');
            } else {
                slot.innerHTML = '<span class="slot-label">' + getSlotLabel(i) + '</span>';
            }
            
            // æ”¾ç½®äº‹ä»¶
            slot.addEventListener('dragover', e => e.preventDefault());
            slot.addEventListener('drop', e => {
                e.preventDefault();
                const idx = parseInt(e.target.closest('.field-slot').dataset.index);
                placeCard(idx);
            });
            
            grid.appendChild(slot);
        }
    }
    
    // æ¸²æŸ“æ•Œæ–¹æˆ˜åœº
    function renderEnemyField() {
        const grid = document.getElementById('enemyFieldGrid');
        if (!grid) return;
        
        grid.innerHTML = '';
        for (let i = 0; i < 6; i++) {
            const minion = game.enemy.field[i];
            const slot = document.createElement('div');
            slot.className = 'field-slot';
            slot.dataset.index = i;
            
            if (minion) {
                slot.classList.add('enemy-minion');
                slot.innerHTML = createMinionHTML(minion, 'enemy');
            } else {
                slot.innerHTML = '<span class="slot-label">' + getSlotLabel(i) + '</span>';
            }
            
            grid.appendChild(slot);
        }
    }
    
    // åˆ›å»ºéšä»HTML
    function createMinionHTML(minion, side) {
        return '<div class="minion-content">' +
            '<div class="minion-art">' + minion.art + '</div>' +
            '<div class="minion-name">' + minion.name + '</div>' +
            '<div class="minion-stats"><span style="color:#fff;">âš”ï¸' + minion.attack + '</span><span style="color:#fff;">â¤ï¸' + minion.health + '</span></div>' +
            '<div class="attack-progress-bar"><div class="attack-progress-fill" style="width:' + (minion.attackProgress || 0) + '%"></div></div>' +
            '</div>';
    }
    
    // æ›´æ–°è¿›åº¦æ¡
    function updateProgressBars() {
        for (let i = 0; i < 6; i++) {
            const minion = game.player.field[i];
            const fill = document.querySelector('#playerFieldGrid .field-slot[data-index="' + i + '"] .attack-progress-fill');
            if (fill && minion) fill.style.width = minion.attackProgress + '%';
        }
        for (let i = 0; i < 6; i++) {
            const minion = game.enemy.field[i];
            const fill = document.querySelector('#enemyFieldGrid .field-slot[data-index="' + i + '"] .attack-progress-fill');
            if (fill && minion) fill.style.width = minion.attackProgress + '%';
        }
    }
    
    // è·å–æ ¼å­æ ‡ç­¾
    function getSlotLabel(idx) {
        return ['å‰å·¦', 'å‰ä¸­', 'å‰å³', 'åå·¦', 'åä¸­', 'åå³'][idx];
    }
    
    // æ”¾ç½®å¡ç‰Œ
    function placeCard(slotIdx) {
        const cardIdx = parseInt(document.querySelector('.hand-card.dragging')?.dataset.index || 0);
        const card = game.player.hand[cardIdx];
        
        if (!card) return;
        if (card.cost > game.player.mana) { showMessage('ğŸ’ åœ£æ°´ä¸è¶³!'); return; }
        if (game.player.field[slotIdx]) { showMessage('âš ï¸ è¯¥æ ¼å­å·²æœ‰éšä»!'); return; }
        
        game.player.mana -= card.cost;
        game.player.hand.splice(cardIdx, 1);
        
        game.player.field[slotIdx] = { ...card, attackProgress: 0 };
        
        document.getElementById('manaDisplay').textContent = game.player.mana + '/' + CONFIG.maxMana;
        renderAll();
        showMessage(card.name + ' -> ' + getSlotLabel(slotIdx) + '!');
    }
    
    // æ›´æ–°ç”Ÿå‘½æ˜¾ç¤º
    function updateHealthDisplay() {
        document.getElementById('playerHealth').textContent = Math.max(0, game.player.health);
        document.getElementById('enemyHealth').textContent = Math.max(0, game.enemy.health);
    }
    
    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(msg) {
        const el = document.createElement('div');
        el.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);padding:20px 40px;border-radius:15px;font-size:1.2rem;font-weight:bold;z-index:200;';
        el.textContent = msg;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 2000);
        console.log('ğŸ’¬ ' + msg);
    }
    
    // æ£€æŸ¥æ¸¸æˆç»“æŸ
    function checkGameEnd() {
        if (game.player.health <= 0) {
            game.isRunning = false;
            showMessage('ğŸ’€ ä½ è¾“äº†!');
            setTimeout(() => alert('ğŸ’€ æ¸¸æˆç»“æŸ! æ•Œæ–¹è·èƒœ!'), 500);
        } else if (game.enemy.health <= 0) {
            game.isRunning = false;
            showMessage('ğŸ‰ ä½ èµ¢äº†!');
            setTimeout(() => alert('ğŸ‰ æ¸¸æˆç»“æŸ! ä½ è·èƒœ!'), 500);
        }
    }
    
    // é‡æ–°å¼€å§‹
    function restartGame() {
        location.reload();
    }
    
    // å¯åŠ¨
    window.onload = function() {
        console.log('ğŸ“„ DOMåŠ è½½å®Œæˆ');
        initGame();
    };
    </script>
</body>
</html>
