<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ Arena Legends - å®æ—¶å¯¹æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* å¯¼èˆª */
        .nav {
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .nav-links a {
            color: #fff;
            text-decoration: none;
            opacity: 0.8;
            font-size: 0.9rem;
            transition: opacity 0.3s;
        }
        
        .nav-links a:hover, .nav-links a.active {
            opacity: 1;
        }
        
        .nav-links a.active {
            color: #f39c12;
        }
        
        /* è¿æ¥çŠ¶æ€ */
        .connection-status {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background: rgba(0,0,0,0.7);
            border-radius: 20px;
            font-size: 0.9rem;
            z-index: 100;
        }
        
        .status-connected {
            background: rgba(46, 204, 113, 0.3);
            border: 1px solid #2ecc71;
        }
        
        .status-disconnected {
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 20px;
        }
        
        /* æˆ¿é—´ä¿¡æ¯ */
        .room-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .room-code {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 10px;
            color: #f39c12;
            background: rgba(0,0,0,0.3);
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
        }
        
        /* ç©å®¶é¢æ¿ */
        .players-panel {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .player-panel {
            flex: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
        }
        
        .player-panel.player1 {
            border: 2px solid #3498db;
        }
        
        .player-panel.player2 {
            border: 2px solid #9b59b6;
        }
        
        .player-panel.active {
            box-shadow: 0 0 30px rgba(243, 156, 18, 0.5);
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .player1 .player-avatar {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .player2 .player-avatar {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .player-health {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .player-mana {
            font-size: 1.2rem;
            color: #3498db;
        }
        
        /* æˆ˜åœº */
        .battlefield {
            background: linear-gradient(180deg, 
                #2c3e50 0%, 
                #34495e 30%, 
                #2ecc71 50%, 
                #27ae60 80%, 
                #1e8449 100%);
            border-radius: 20px;
            padding: 20px;
            min-height: 400px;
            position: relative;
        }
        
        .battlefield-info {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .battlefield-info .turn-indicator {
            font-weight: bold;
            color: #f39c12;
        }
        
        /* éšä»åŒº */
        .minions-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            min-height: 90px;
            flex-wrap: wrap;
            padding: 10px;
        }
        
        .enemy-minion {
            width: 70px;
            height: 90px;
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: float 2s ease-in-out infinite;
            border: 2px solid #8e44ad;
        }
        
        .enemy-minion .art {
            font-size: 2rem;
        }
        
        .enemy-minion .stats {
            display: flex;
            gap: 8px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .enemy-minion .attack { color: #e74c3c; }
        .enemy-minion .health { color: #2ecc71; }
        
        /* ä¸­å¤®ä¿¡æ¯ */
        .center-info {
            text-align: center;
            padding: 20px;
            opacity: 0.6;
            font-size: 0.9rem;
        }
        
        /* æ‰‹ç‰ŒåŒº */
        .hand-area {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .hand-label {
            text-align: center;
            margin-bottom: 15px;
            opacity: 0.7;
        }
        
        .hand-cards {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .hand-card {
            width: 110px;
            height: 150px;
            background: linear-gradient(180deg, #2c3e50, #34495e);
            border-radius: 12px;
            padding: 8px;
            position: relative;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 2px solid #555;
            user-select: none;
        }
        
        .hand-card:hover {
            transform: translateY(-15px) scale(1.05);
            border-color: #f39c12;
            box-shadow: 0 15px 40px rgba(243, 156, 18, 0.3);
            z-index: 10;
        }
        
        .hand-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        
        .hand-card .cost {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            border: 2px solid #fff;
        }
        
        .hand-card .art {
            font-size: 2.5rem;
            text-align: center;
            margin: 10px 0;
        }
        
        .hand-card .name {
            font-size: 0.75rem;
            text-align: center;
            font-weight: bold;
        }
        
        .hand-card .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 5px;
        }
        
        .hand-card .attack { color: #e74c3c; font-size: 0.85rem; font-weight: bold; }
        .hand-card .health { color: #2ecc71; font-size: 0.85rem; font-weight: bold; }
        
        /* æ”¾ç½®åŒº */
        .drop-zones {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .drop-zone {
            width: 90px;
            height: 90px;
            background: rgba(255,255,255,0.1);
            border: 3px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .drop-zone:hover, .drop-zone.drag-over {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: scale(1.05);
        }
        
        .drop-zone .icon {
            font-size: 1.8rem;
            margin-bottom: 3px;
        }
        
        .drop-zone .label {
            font-size: 0.7rem;
            opacity: 0.7;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-end {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            color: #fff;
        }
        
        .btn-end:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.4);
        }
        
        .btn-end:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* å¼€å§‹é¢æ¿ */
        .start-panel {
            text-align: center;
            padding: 60px 20px;
        }
        
        .start-panel h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .start-panel p {
            opacity: 0.7;
            margin-bottom: 30px;
        }
        
        .start-btn {
            display: inline-block;
            padding: 20px 50px;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            border-radius: 30px;
            color: #fff;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
        }
        
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(243, 156, 18, 0.5);
        }
        
        .instructions {
            max-width: 500px;
            margin: 40px auto;
            text-align: left;
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 15px;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            color: #f39c12;
        }
        
        .instructions ol {
            padding-left: 20px;
            opacity: 0.8;
        }
        
        .instructions li {
            margin: 10px 0;
        }
        
        /* åŠ¨ç”» */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        /* éšè— */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆª -->
    <nav class="nav">
        <div class="logo">âš”ï¸ Arena Legends</div>
        <div class="nav-links">
            <a href="index.html">ğŸ  é¦–é¡µ</a>
            <a href="game.html">ğŸ® å•æœºå¯¹æˆ˜</a>
            <a href="multiplayer.html" class="active">ğŸŒ å®æ—¶å¯¹æˆ˜</a>
        </div>
    </nav>
    
    <!-- è¿æ¥çŠ¶æ€ -->
    <div class="connection-status status-disconnected" id="connectionStatus">
        ğŸ”´ æœªè¿æ¥ - è¯·æ‰“å¼€å¦ä¸€ä¸ªæµè§ˆå™¨çª—å£
    </div>
    
    <!-- å¼€å§‹é¢æ¿ -->
    <div class="start-panel" id="startPanel">
        <h1>ğŸŒ å®æ—¶å¯¹æˆ˜</h1>
        <p>ä¸å¥½å‹è¿›è¡Œå®æ—¶PVPå¯¹æˆ˜!</p>
        
        <button class="start-btn" onclick="startMultiplayer()">
            ğŸ® å¼€å§‹å®æ—¶å¯¹æˆ˜
        </button>
        
        <div class="instructions">
            <h3>ğŸ“‹ å¯¹æˆ˜è¯´æ˜</h3>
            <ol>
                <li>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»ºæˆ¿é—´</li>
                <li>å¤åˆ¶æˆ¿é—´å·å‘é€ç»™å¥½å‹</li>
                <li>å¥½å‹è¾“å…¥æˆ¿é—´å·åŠ å…¥æ¸¸æˆ</li>
                <li>æ‹–æ‹½å¡ç‰Œåˆ°æˆ˜åœºåŒºåŸŸ</li>
                <li>å›åˆåˆ¶å¯¹æˆ˜ï¼Œå‡»è´¥æ•Œæ–¹è‹±é›„!</li>
            </ol>
        </div>
    </div>
    
    <!-- æ¸¸æˆç•Œé¢ -->
    <div class="game-container hidden" id="gamePanel">
        <!-- æˆ¿é—´å· -->
        <div class="room-info">
            <div class="room-code" id="roomCode">------</div>
        </div>
        
        <!-- ç©å®¶é¢æ¿ -->
        <div class="players-panel">
            <div class="player-panel player1 active" id="player1Panel">
                <div class="player-header">
                    <div class="player-avatar">ğŸ‘¤</div>
                    <div>
                        <div class="player-health">â¤ï¸ <span id="p1Health">30</span></div>
                        <div class="player-mana">ğŸ’ <span id="p1Mana">5/10</span></div>
                    </div>
                </div>
            </div>
            
            <div class="player-panel player2">
                <div class="player-header">
                    <div>
                        <div class="player-health">â¤ï¸ <span id="p2Health">30</span></div>
                        <div class="player-mana">ğŸ’ <span id="p2Mana">5/10</span></div>
                    </div>
                    <div class="player-avatar">ğŸ‘¤</div>
                </div>
            </div>
        </div>
        
        <!-- æˆ˜åœº -->
        <div class="battlefield">
            <div class="battlefield-info">
                <span class="turn-indicator" id="turnIndicator">â³ ç­‰å¾…å¯¹æ‰‹...</span>
            </div>
            
            <!-- æ•Œæ–¹éšä» -->
            <div class="minions-row" id="enemyMinions">
                <!-- æ•Œæ–¹éšä»æ¸²æŸ“åœ¨è¿™é‡Œ -->
            </div>
            
            <!-- ä¸­å¤®ä¿¡æ¯ -->
            <div class="center-info">
                âš”ï¸ å®æ—¶å¯¹æˆ˜åŒºåŸŸ
            </div>
            
            <!-- æˆ‘æ–¹éšä» -->
            <div class="minions-row" id="playerMinions">
                <!-- æˆ‘æ–¹éšä»æ¸²æŸ“åœ¨è¿™é‡Œ -->
            </div>
            
            <!-- æ”¾ç½®åŒº -->
            <div class="drop-zones">
                <div class="drop-zone" data-zone="support">
                    <span class="icon">ğŸª„</span>
                    <span class="label">è¾…åŠ©åŒº</span>
                </div>
                <div class="drop-zone" data-zone="tank">
                    <span class="icon">ğŸ›¡ï¸</span>
                    <span class="label">å¦å…‹åŒº</span>
                </div>
                <div class="drop-zone" data-zone="warrior">
                    <span class="icon">âš”ï¸</span>
                    <span class="label">æˆ˜å£«åŒº</span>
                </div>
            </div>
        </div>
        
        <!-- æ‰‹ç‰Œ -->
        <div class="hand-area">
            <div class="hand-label">ğŸ´ æ‹–æ‹½å¡ç‰Œåˆ°æˆ˜åœºåŒºåŸŸ</div>
            <div class="hand-cards" id="handCards">
                <!-- æ‰‹ç‰Œæ¸²æŸ“åœ¨è¿™é‡Œ -->
            </div>
        </div>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="btn btn-end" id="endTurnBtn" disabled>â³ ç­‰å¾…å¯¹æ‰‹</button>
        </div>
    </div>
    
    <script>
        // ğŸ® å®æ—¶å¯¹æˆ˜æ¸¸æˆ
        const MultiplayerGame = {
            // æ¸¸æˆçŠ¶æ€
            playerId: null,
            roomId: null,
            channel: null,
            isMyTurn: false,
            
            // æ¸¸æˆæ•°æ®
            player: {
                health: 30,
                mana: 5,
                maxMana: 10,
                hand: [],
                field: []
            },
            opponent: {
                health: 30,
                field: []
            },
            
            // åˆå§‹åŒ–
            init() {
                this.setupChannel();
                this.setupDragDrop();
            },
            
            // è®¾ç½®BroadcastChannelé€šä¿¡
            setupChannel() {
                // ä»URLè·å–æˆ¿é—´å·
                const urlParams = new URLSearchParams(window.location.search);
                this.roomId = urlParams.get('room') || this.generateRoomId();
                
                if (!urlParams.get('room')) {
                    // æ›´æ–°URL
                    window.history.replaceState({}, '', `?room=${this.roomId}`);
                }
                
                // åˆ›å»ºé¢‘é“
                this.channel = new BroadcastChannel(`arena_${this.roomId}`);
                
                // ç›‘å¬æ¶ˆæ¯
                this.channel.onmessage = (event) => {
                    this.handleMessage(event.data);
                };
                
                // ç©å®¶1 = åˆ›å»ºè€…, ç©å®¶2 = åŠ å…¥è€…
                const players = this.getRoomPlayers();
                if (players.length === 0) {
                    this.playerId = 1;
                    players.push(this.playerId);
                } else {
                    this.playerId = players[0] === 1 ? 2 : 1;
                    players.push(this.playerId);
                }
                
                // æ›´æ–°UI
                document.getElementById('roomCode').textContent = this.roomId;
                
                // é€šçŸ¥å…¶ä»–ç©å®¶
                this.broadcast({
                    type: 'player_joined',
                    playerId: this.playerId
                });
                
                // æ›´æ–°è¿æ¥çŠ¶æ€
                this.updateConnectionStatus();
                
                // æ£€æŸ¥æ˜¯å¦å¼€å§‹æ¸¸æˆ
                if (players.length >= 2) {
                    this.startGame();
                }
            },
            
            // ç”Ÿæˆæˆ¿é—´å·
            generateRoomId() {
                return Math.random().toString(36).substring(2, 8).toUpperCase();
            },
            
            // è·å–æˆ¿é—´ç©å®¶
            getRoomPlayers() {
                const key = `arena_players_${this.roomId}`;
                const stored = localStorage.getItem(key);
                return stored ? JSON.parse(stored) : [];
            },
            
            // å‘é€å¹¿æ’­
            broadcast(data) {
                this.channel.postMessage(data);
            },
            
            // å¤„ç†æ¶ˆæ¯
            handleMessage(data) {
                switch (data.type) {
                    case 'player_joined':
                        this.handlePlayerJoined(data.playerId);
                        break;
                    case 'play_card':
                        this.handlePlayCard(data);
                        break;
                    case 'end_turn':
                        this.handleEndTurn();
                        break;
                    case 'attack':
                        this.handleAttack(data);
                        break;
                }
            },
            
            // å¤„ç†ç©å®¶åŠ å…¥
            handlePlayerJoined(playerId) {
                if (playerId !== this.playerId) {
                    this.opponentId = playerId;
                    this.updateConnectionStatus();
                    
                    if (this.getRoomPlayers().length >= 2) {
                        this.startGame();
                    }
                }
            },
            
            // æ›´æ–°è¿æ¥çŠ¶æ€
            updateConnectionStatus() {
                const status = document.getElementById('connectionStatus');
                const players = this.getRoomPlayers();
                
                if (players.length >= 2) {
                    status.textContent = 'ğŸŸ¢ å·²è¿æ¥ - æ¸¸æˆå‡†å¤‡å°±ç»ª!';
                    status.className = 'connection-status status-connected';
                } else {
                    status.textContent = 'ğŸŸ¡ ç­‰å¾…ç©å®¶åŠ å…¥...';
                    status.className = 'connection-status';
                }
            },
            
            // å¼€å§‹æ¸¸æˆ
            startGame() {
                document.getElementById('startPanel').classList.add('hidden');
                document.getElementById('gamePanel').classList.remove('hidden');
                
                // åˆå§‹åŒ–æ¸¸æˆæ•°æ®
                this.initGameData();
                
                // éšæœºå…ˆæ‰‹
                this.isMyTurn = Math.random() > 0.5;
                
                // æ¸²æŸ“
                this.render();
                this.updateTurnIndicator();
                
                console.log(`ğŸ® æ¸¸æˆå¼€å§‹! ä½ æ˜¯ç©å®¶${this.playerId}, ${this.isMyTurn ? 'ä½ å…ˆæ‰‹' : 'å¯¹æ‰‹å…ˆæ‰‹'}`);
            },
            
            // åˆå§‹åŒ–æ¸¸æˆæ•°æ®
            initGameData() {
                const cardTemplates = [
                    { name: 'ç‹¼éª‘å…µ', cost: 3, attack: 4, health: 3, art: 'ğŸº', keywords: ['charge'] },
                    { name: 'ç«å…ƒç´ ', cost: 4, attack: 5, health: 5, art: 'ğŸ”¥', keywords: [] },
                    { name: 'å†°éœœéª‘å£«', cost: 5, attack: 6, health: 6, art: 'ğŸ›¡ï¸', keywords: ['taunt'] },
                    { name: 'ç²¾çµå¼“æ‰‹', cost: 2, attack: 3, health: 2, art: 'ğŸ¹', keywords: ['rush'] },
                    { name: 'æ²»ç–—ç²¾çµ', cost: 2, attack: 1, health: 4, art: 'ğŸ’š', keywords: ['battlecry'] },
                    { name: 'é—ªç”µç®­', cost: 3, attack: 4, health: 2, art: 'âš¡', keywords: [] },
                    { name: 'ç«é¾™', cost: 6, attack: 8, health: 7, art: 'ğŸ‰', keywords: ['charge'] }
                ];
                
                // å‘ç‰Œ
                for (let i = 0; i < 4; i++) {
                    const card = { ...cardTemplates[Math.floor(Math.random() * cardTemplates.length)], id: `p${this.playerId}_${Date.now()}_${i}` };
                    this.player.hand.push(card);
                }
            },
            
            // è®¾ç½®æ‹–æ‹½
            setupDragDrop() {
                document.addEventListener('dragstart', (e) => {
                    if (e.target.classList.contains('hand-card')) {
                        this.draggedCard = e.target;
                        e.target.classList.add('dragging');
                    }
                });
                
                document.addEventListener('dragend', (e) => {
                    if (e.target.classList.contains('hand-card')) {
                        e.target.classList.remove('dragging');
                        this.draggedCard = null;
                    }
                });
                
                document.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                
                document.addEventListener('dragenter', (e) => {
                    if (e.target.classList.contains('drop-zone')) {
                        e.target.classList.add('drag-over');
                    }
                });
                
                document.addEventListener('dragleave', (e) => {
                    if (e.target.classList.contains('drop-zone')) {
                        e.target.classList.remove('drag-over');
                    }
                });
                
                document.addEventListener('drop', (e) => {
                    e.preventDefault();
                    
                    if (!this.isMyTurn) {
                        this.showMessage('â³ ç­‰å¾…ä½ çš„å›åˆ!');
                        return;
                    }
                    
                    const dropZone = e.target.classList.contains('drop-zone') ? e.target : e.target.closest('.drop-zone');
                    
                    if (dropZone && this.draggedCard) {
                        const cardId = this.draggedCard.dataset.cardId;
                        this.playCard(cardId, dropZone.dataset.zone);
                    }
                    
                    dropZone?.classList.remove('drag-over');
                });
                
                // ç»“æŸå›åˆ
                document.getElementById('endTurnBtn').addEventListener('click', () => {
                    this.endTurn();
                });
            },
            
            // å‡ºç‰Œ
            playCard(cardId, zone) {
                const cardIndex = this.player.hand.findIndex(c => c.id === cardId);
                if (cardIndex === -1) return;
                
                const card = this.player.hand[cardIndex];
                
                if (card.cost > this.player.mana) {
                    this.showMessage('ğŸ’ åœ£æ°´ä¸è¶³!');
                    return;
                }
                
                // æ‰£è´¹
                this.player.mana -= card.cost;
                
                // ç§»å‡ºæ‰‹ç‰Œ
                this.player.hand.splice(cardIndex, 1);
                
                // æ”¾ç½®åˆ°æˆ˜åœº
                card.zone = zone;
                this.player.field.push(card);
                
                // å¹¿æ’­å‡ºç‰Œ
                this.broadcast({
                    type: 'play_card',
                    playerId: this.playerId,
                    card: card,
                    zone: zone
                });
                
                // æ¸²æŸ“
                this.render();
                this.showMessage(`ğŸ´ ä½ æ‰“å‡ºäº† ${card.name}!`);
            },
            
            // å¤„ç†å‡ºç‰Œ
            handlePlayCard(data) {
                if (data.playerId !== this.playerId) {
                    this.opponent.field.push(data.card);
                    this.render();
                    this.showMessage(`ğŸ˜ˆ å¯¹æ‰‹æ‰“å‡ºäº† ${data.card.name}!`);
                }
            },
            
            // ç»“æŸå›åˆ
            endTurn() {
                this.isMyTurn = false;
                this.updateTurnIndicator();
                
                this.broadcast({
                    type: 'end_turn',
                    playerId: this.playerId
                });
                
                this.showMessage('â³ ç­‰å¾…å¯¹æ‰‹è¡ŒåŠ¨...');
                
                // æ¨¡æ‹Ÿå¯¹æ‰‹è¡ŒåŠ¨
                setTimeout(() => {
                    this.isMyTurn = true;
                    this.player.mana = Math.min(this.player.mana + 2, this.player.maxMana);
                    this.drawCard();
                    this.updateTurnIndicator();
                    this.render();
                    this.showMessage('âš”ï¸ ä½ çš„å›åˆ!');
                }, 2000);
            },
            
            // å¤„ç†ç»“æŸå›åˆ
            handleEndTurn(data) {
                if (data.playerId !== this.playerId) {
                    this.isMyTurn = true;
                    this.player.mana = Math.min(this.player.mana + 2, this.player.maxMana);
                    this.drawCard();
                    this.updateTurnIndicator();
                    this.render();
                }
            },
            
            // æŠ½ç‰Œ
            drawCard() {
                const cardTemplates = [
                    { name: 'ç‹¼éª‘å…µ', cost: 3, attack: 4, health: 3, art: 'ğŸº' },
                    { name: 'ç«å…ƒç´ ', cost: 4, attack: 5, health: 5, art: 'ğŸ”¥' },
                    { name: 'æ²»ç–—ç²¾çµ', cost: 2, attack: 1, health: 4, art: 'ğŸ’š' }
                ];
                
                if (this.player.hand.length < 7) {
                    const card = { ...cardTemplates[Math.floor(Math.random() * cardTemplates.length)], id: `p${this.playerId}_${Date.now()}` };
                    this.player.hand.push(card);
                }
            },
            
            // å¤„ç†æ”»å‡»
            handleAttack(data) {
                // ç®€åŒ–ï¼šåªè®°å½•ä¼¤å®³
                if (data.target === 'hero') {
                    if (data.playerId === this.playerId) {
                        this.opponent.health -= data.damage;
                    } else {
                        this.player.health -= data.damage;
                    }
                }
                
                this.render();
                this.checkGameEnd();
            },
            
            // æ›´æ–°å›åˆæŒ‡ç¤º
            updateTurnIndicator() {
                const indicator = document.getElementById('turnIndicator');
                const btn = document.getElementById('endTurnBtn');
                
                if (this.isMyTurn) {
                    indicator.textContent = 'âš”ï¸ ä½ çš„å›åˆ!';
                    btn.disabled = false;
                    btn.textContent = 'âœ… ç»“æŸå›åˆ';
                    document.getElementById('player1Panel').classList.add('active');
                    document.getElementById('player2Panel').classList.remove('active');
                } else {
                    indicator.textContent = 'â³ å¯¹æ‰‹å›åˆ...';
                    btn.disabled = true;
                    btn.textContent = 'â³ ç­‰å¾…å¯¹æ‰‹';
                    document.getElementById('player1Panel').classList.remove('active');
                    document.getElementById('player2Panel').classList.add('active');
                }
            },
            
            // æ¸²æŸ“
            render() {
                // æ›´æ–°çŠ¶æ€
                document.getElementById('p1Health').textContent = this.player.health;
                document.getElementById('p1Mana').textContent = `${this.player.mana}/${this.player.maxMana}`;
                document.getElementById('p2Health').textContent = this.opponent.health;
                
                // æ¸²æŸ“æ‰‹ç‰Œ
                const handContainer = document.getElementById('handCards');
                handContainer.innerHTML = this.player.hand.map(card => `
                    <div class="hand-card" draggable="${this.isMyTurn}" data-card-id="${card.id}">
                        <div class="cost">${card.cost}</div>
                        <div class="art">${card.art}</div>
                        <div class="name">${card.name}</div>
                        <div class="stats">
                            <span class="attack">âš”ï¸${card.attack}</span>
                            <span class="health">â¤ï¸${card.health}</span>
                        </div>
                    </div>
                `).join('');
                
                // é‡æ–°æ·»åŠ æ‹–æ‹½äº‹ä»¶
                if (this.isMyTurn) {
                    this.player.hand.forEach(card => {
                        const el = handContainer.querySelector(`[data-card-id="${card.id}"]`);
                        if (el) {
                            el.addEventListener('dragstart', () => {
                                this.draggedCard = el;
                                el.classList.add('dragging');
                            });
                            el.addEventListener('dragend', () => {
                                el.classList.remove('dragging');
                                this.draggedCard = null;
                            });
                        }
                    });
                }
                
                // æ¸²æŸ“æˆ‘æ–¹éšä»
                const playerMinions = document.getElementById('playerMinions');
                playerMinions.innerHTML = this.player.field.map(card => `
                    <div class="enemy-minion" style="background: linear-gradient(135deg, #c0392b, #e74c3c); border-color: #c0392b;">
                        <div class="art">${card.art}</div>
                        <div class="stats">
                            <span class="attack">âš”ï¸${card.attack}</span>
                            <span class="health">â¤ï¸${card.health}</span>
                        </div>
                    </div>
                `).join('');
                
                // æ¸²æŸ“æ•Œæ–¹éšä»
                const enemyMinions = document.getElementById('enemyMinions');
                enemyMinions.innerHTML = this.opponent.field.map(card => `
                    <div class="enemy-minion">
                        <div class="art">${card.art}</div>
                        <div class="stats">
                            <span class="attack">âš”ï¸${card.attack}</span>
                            <span class="health">â¤ï¸${card.health}</span>
                        </div>
                    </div>
                `).join('');
                
                this.checkGameEnd();
            },
            
            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            checkGameEnd() {
                if (this.player.health <= 0) {
                    this.showMessage('ğŸ’€ ä½ è¾“äº†!');
                    setTimeout(() => alert('ğŸ˜ˆ å¯¹æ‰‹è·èƒœ!'), 100);
                } else if (this.opponent.health <= 0) {
                    this.showMessage('ğŸ‰ ä½ èµ¢äº†!');
                    setTimeout(() => alert('ğŸ‰ ä½ è·èƒœ!'), 100);
                }
            },
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(text) {
                const msgEl = document.getElementById('turnIndicator');
                if (msgEl) {
                    msgEl.textContent = text;
                }
            }
        };
        
        // å¼€å§‹å¤šäººæ¸¸æˆ
        function startMultiplayer() {
            MultiplayerGame.init();
        }
        
        // é¡µé¢åŠ è½½åæ£€æŸ¥URL
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('room')) {
                startMultiplayer();
            }
        });
        
        console.log('âš”ï¸ Arena Legends - å®æ—¶å¯¹æˆ˜æ¨¡å¼');
        console.log('ğŸ’¡ æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨çª—å£å³å¯å¯¹æˆ˜!');
    </script>
</body>
</html>
